<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>ç–¾ç—…è¯¦æƒ… - MedLink</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/css/common.css">
    <style>
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
        }

        .card-title {
            color: #cc0000;
            font-weight: 600;
        }

        .disease-label {
            font-weight: bold;
            color: #444;
        }
    </style>
</head>
<body class="d-flex flex-column min-vh-100">

<div data-include="header.html"></div>

<div class="container mt-4">
    <div class="card p-4">
        <h3 id="disease-name" class="card-title"><i class="bi bi-activity"></i> ç–¾ç—…åç§°</h3>
        <p><i class="bi bi-tag"></i><span class="disease-label">OMIM IDï¼š</span><span id="disease-omim-id">OMIM12345</span></p>
        <p><i class="bi bi-globe"></i><span class="disease-label">è‹±æ–‡åï¼š</span><span id="disease-english-name">Disease Name</span></p>
        <p><i class="bi bi-chat-dots"></i><span class="disease-label">ä¸­æ–‡åï¼š</span><span id="disease-chinese-name">ç–¾ç—…åç§°</span></p>
    </div>

    <div class="card p-4">
        <h4 class="card-title mb-3">ç–¾ç—…-è¯ç‰©å…³ç³»å›¾è°±</h4>
        <div id="relation-graph" style="width: 100%; height: 500px;"></div>
    </div>

    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card p-3">
                <h5 class="card-title">ç–¾ç—…ç±»å‹</h5>
                <p id="disease-type">æš‚æ— æ•°æ®</p>
            </div>
            <div class="card p-3">
                <h5 class="card-title">æè¿°</h5>
                <p id="disease-description">æš‚æ— æ•°æ®</p>
            </div>
            <div class="card p-3">
                <h5 class="card-title">ç—‡çŠ¶</h5>
                <p id="disease-symptoms">æš‚æ— æ•°æ®</p>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card p-3">
                <h5 class="card-title">å½±å“ç³»ç»Ÿ</h5>
                <p id="disease-system">æš‚æ— æ•°æ®</p>
            </div>
            <div class="card p-3">
                <h5 class="card-title">æµè¡Œæƒ…å†µ</h5>
                <p id="disease-prevalence">æš‚æ— æ•°æ®</p>
            </div>
            <div class="card p-3">
                <h5 class="card-title">æ¥æº</h5>
                <p id="disease-source">æš‚æ— æ•°æ®</p>
            </div>
        </div>
    </div>
</div>

<footer class="footer mt-auto text-center">
    <div class="container">
        <p>&copy; 2025 MedLink è¯ç‰©é¢„æµ‹å¹³å°</p>
        <a href="#">å…³äºæˆ‘ä»¬</a> | <a href="#">è”ç³»æˆ‘ä»¬</a>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
<script src="/js/include.js"></script>
<script>
    const diseaseId = new URLSearchParams(window.location.search).get("id");

    if (diseaseId) {
        fetch(`/api/diseases/${diseaseId}`)
            .then(res => res.json())
            .then(data => {
                document.getElementById("disease-name").textContent = data.chineseName || "æœªå‘½åç–¾ç—…";
                document.getElementById("disease-omim-id").textContent = data.omimId || "æ— ";
                document.getElementById("disease-english-name").textContent = data.englishName || "æ— ";
                document.getElementById("disease-chinese-name").textContent = data.chineseName || "æ— ";
                document.getElementById("disease-type").textContent = data.diseaseType || "æš‚æ— æ•°æ®";
                document.getElementById("disease-description").textContent = data.description || "æš‚æ— æ•°æ®";
                document.getElementById("disease-symptoms").textContent = data.symptoms || "æš‚æ— æ•°æ®";
                document.getElementById("disease-system").textContent = data.affectedSystem || "æš‚æ— æ•°æ®";
                document.getElementById("disease-prevalence").textContent = data.prevalence || "æš‚æ— æ•°æ®";
                document.getElementById("disease-source").textContent = data.source || "æš‚æ— æ•°æ®";
            })
            .catch(err => console.error("âŒ è·å–ç–¾ç—…è¯¦æƒ…å¤±è´¥", err));

        fetch(`/api/diseases/disease-graph/${diseaseId}`)
            .then(res => res.json())
            .then(graphData => {
                const chartDom = document.getElementById("relation-graph");
                const myChart = echarts.init(chartDom);
                const option = {
                    tooltip: {
                        formatter: (params) => {
                            if (params.data.category === "ç–¾ç—…") return `ğŸ§¬ ç–¾ç—…ï¼š${params.data.name}`;
                            if (params.data.category === "è¯ç‰©") return `ğŸ’Š è¯ç‰©ï¼š${params.data.name}`;
                            return params.data.relation || '';
                        }
                    },
                    legend: [{ data: ['ç–¾ç—…', 'è¯ç‰©'] }],
                    series: [{
                        type: 'graph',
                        layout: 'force',
                        roam: true,
                        label: {
                            show: true,
                            position: 'right',
                            fontSize: 12
                        },
                        force: {
                            repulsion: 500,
                            edgeLength: [100, 200],
                            gravity: 0.2
                        },
                        edgeSymbol: ['none', 'arrow'],
                        edgeSymbolSize: [4, 8],
                        edgeLabel: {
                            show: true,
                            fontSize: 10,
                            formatter: function (params) {
                                return params.data.label || '';
                            }
                        },
                        categories: [
                            { name: 'ç–¾ç—…', itemStyle: { color: '#ff7f0e' } },
                            { name: 'è¯ç‰©', itemStyle: { color: '#1f77b4' } }
                        ],
                        data: graphData.nodes.map(node => ({
                            ...node,
                            draggable: true,
                            symbolSize: node.category === 'ç–¾ç—…' ? 70 : 50,
                            category: node.category
                        })),
                        links: graphData.links.map(link => ({
                            source: link.source,
                            target: link.target,
                            label: { show: true, formatter: link.relation },
                            lineStyle: { curveness: 0.25 }
                        })),
                        lineStyle: {
                            color: '#aaa',
                            width: 2
                        }
                    }]
                };
                myChart.setOption(option);
            })
            .catch(err => console.warn("âš ï¸ è·å–å›¾è°±æ•°æ®å¤±è´¥", err));
    } else {
        console.warn("âš ï¸ æœªæä¾› diseaseId å‚æ•°");
    }
</script>
</body>
</html>
